<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.ssafy.happyhouse.model.mapper.DongReviewMapper">

	<select id="getReviewByUser" parameterType="string" resultType="DongReviewDto">
		select
			dongcode,userid,infra,trans,safety,health,school,environment,content
		from dong_review
		where userid = #{userid};
	</select>

	<select id="getReviewByDong" parameterType="string" resultType="DongReviewDto">
		select
			dongcode,userid,infra,trans,safety,health,school,environment,content
		from dong_review
		where dongcode = #{dongcode};
	</select>
	
	<select id="getRatingAll" resultType="Map">
		SELECT	R1.dongcode,
				CONCAT((R1.infra + R1.trans + R1.safety + R1.health + R1.school + R1.environment)/6) as total, 
				CONCAT(R1.infra) infra, CONCAT(R1.trans) trans, CONCAT(R1.safety) safety, CONCAT(R1.health) health, CONCAT(R1.school) school, CONCAT(R1.environment) environment
		FROM	dong_rating R1
		JOIN	dong_rating R2 USING(dongcode)
	</select>

	<select id="getRatingByDong" parameterType="String" resultType="Map">
		SELECT	R1.dongcode,
				CONCAT((R1.infra + R1.trans + R1.safety + R1.health + R1.school + R1.environment)/6) as total, 
				CONCAT(R1.infra) infra, CONCAT(R1.trans) trans, CONCAT(R1.safety) safety, CONCAT(R1.health) health, CONCAT(R1.school) school, CONCAT(R1.environment) environment
		FROM	dong_rating R1
		JOIN	dong_rating R2 USING(dongcode)
		WHERE 	R1.dongcode = #{dongcode};
	</select>

	<insert id="insert" parameterType="DongReviewDto">
		insert into dong_review
		values
		(#{dongcode},#{userid},#{infra},#{trans},#{safety},#{health},#{school},#{environment},#{content})
	</insert>

	<delete id="delete" parameterType="string">
		delete from dong_review
		where
		userid = #{userid}
	</delete>

	<update id="update" parameterType="DongReviewDto">
		update dong_review
		set infra =
		#{infra},trans = #{trans},safety = #{safety},health =#{health},
		school
		= #{school},environment = #{environment},
		content = #{content}
		where
		userid = #{userid}
	</update>


</mapper>